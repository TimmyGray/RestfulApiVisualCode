<!DOCTYPE html>
<html style="height: 100%;">
<head>
    <meta charset="utf-8" />
    <meta name="clientview" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Происшествия</title>
    <link rel="stylesheet" type="text/css" href="bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">

</head>
<body id="body">

    <header class="p-3 text-white">
        <div class="container">
            <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
                <a href="#" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
                    <img src="Resources/warning-sign.svg" alt="" height="50" width="50">
                </a>

                <ul id="nav" class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                    <li><a href="#" name="Create" class="nav-link px-2" id="CreateClick">Создать</a></li>
                    <li><a href="#" name="Histories" class="nav-link px-2" id="HistoryClick">История</a></li>
                    <li><a href="#" name="Faq" class="nav-link px-2" id="FaqClick">Бестиарий</a></li>
                </ul>

                <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3">
                    <input type="search" class="form-control form-control-dark" placeholder="Искать..." aria-label="Search">
                </form>

                <div class="text-end">
                    <button type="button" class="btn btn-softyellow me-2">Войти</button>
                    <button type="button" class="btn btn-softbrown">Регистрация</button>
                </div>
            </div>
        </div>
    </header>

    <main id="Create" name="Create">
        <div class="container justify-content-center">
            <h1 id="FirstPage" style="text-align: center;">Карточка происшествия</h1>
        </div>
        <form name="eventForm" class="was was-validated" id="cardevent">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6 col-lg-4 col-sm-6 col-12 mb-3">
                        <label for="nameofdevice">Устройство</label>
                        <select class="form-select d-block w-100 d-done" name="nameofdevice" required>
                            <option value>Выбрать...</option>
                            <option>SSL</option>
                            <option>Karrera</option>
                            <option>SoundCraft</option>
                            <option>Dalet</option>
                            <option>Микрофон, мониторинг, приемопередатчик</option>
                            <option>Platinum</option>
                            <option>Свет и оборудование</option>
                            <option>Декорации</option>
                            <option>Камеры и камерные каналы</option>
                            <option>Графические станции</option>
                            <option>Компьютер</option>
                            <option>Другое</option>
                        </select>
                        <div class="invalid-feedback">Необходимо указать устройство</div>
                    </div>
                    <div class="col-auto mb-3">
                        <label for="nameofasb">Номер АСБ</label>
                        <select class="form-select d-block w-100 d-done" name="nameofasb" required>
                            <option value>Выбрать...</option>
                            <option>1</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                            <option>6</option>
                            <option>7</option>
                            <option>8</option>
                        </select>
                        <div class="invalid-feedback">Необхоимо указать номер АСБ</div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 col-lg-4 col-sm-6 col-12 mb-3">
                        <div class="form-group">
                            <label for="eventdiscribe">Описание проблемы</label>
                            <textarea class="form-control" name="discribeevent" rows="3" required></textarea>
                        </div>
                        <div class="invalid-feedback">Заполните описание</div>

                    </div>
                    <div class="col-auto mb-3">
                        <div class="form-group">
                            <label for="fixdiscribe">Как исправили(если исправили)</label>
                            <textarea class="form-control" name="fixevent" rows="3"></textarea>
                        </div>

                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 col-lg-4 col-sm-6 col-12 mb-3">
                        <label for="dateofevent">Дата происшествия</label>
                        <div class="w-100"></div>
                        <input name="dateofevent" class="form-control"  type="date" required />
                        <div class="invalid-feedback">Укажите дату происшествия</div>
                    </div>
                    <div class="col-auto mb-3">
                        <label for="isserios">Серьезность</label>
                        <select name="isserios" class="form-select d-block w-100 d-done" required>
                            <option value>Выбрать...</option>
                            <option>Серьезное происшествие</option>
                            <option>Несерьезное происшествие</option>
                        </select>
                        <div class="invalid-feedback">Укажите серьезность</div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-7 col-lg-7 col-sm-12 col-12">
                        <div class="input-group mb-3">
                            <label for="inputGroupFile">Фотография поломки</label>
                            <div class="w-100"></div>
                            <input type="file" class="form-control" id="inputGroupFile" aria-describedby="inputGroupFileAddon" aria-label="Загрузить">
                            <button class="btn btn-outline-softbrown" type="button" id="inputGroupFileAddon">Загрузить</button>
                        </div>
                    </div>

                </div>

                <div class="row">
                    <div class="col-md-6 col-lg-4 col-sm-6 col-6 mb-3">
                        <button id="submit" type="submit" class="btn btn-softyellow">Создать</button>
                    </div>
                    <div class="col-auto mb-3">
                        <button id="reset" type="reset" class="btn btn-softyellow">Сброс</button>
                    </div>

                </div>


            </div>
        </form>


    </main>

    <main id="Histories" name="Histories" class="disactivetab">


        <div class="container justify-content-center">
            <h1 id="SecondPage" style="text-align: center;">История происшествий</h1>
        </div>

        <div class="container-fluid">

            <div class="row">
                <div class="col-1 mb-2" hidden id="sortingdiv">
                    <select id="Sorting" class="form-select">
                    </select>

                </div>
                <div class="col-10 mb-2" hidden id="datediv">
                    <div class="row">

                        <div class="col-3">
                            <label for="yearselect">Год</label>
                            <select class="form-select" id="yearselect">
                                <option value>Выбрать...</option>
                                <option>2022</option>
                                <option>2021</option>
                                <option>2020</option>
                                <option>2019</option>
                                <option>2018</option>
                                <option>2017</option>
                                <option>2016</option>
                                <option>2015</option>
                                <option>2014</option>
                                <option>2014</option>
                                <option>2013</option>
                                <option>2012</option>
                                <option>2011</option>
                                <option>2010</option>
                                <option>2009</option>
                                <option>2008</option>
                                <option>2007</option>
                                <option>2007</option>
                                <option>2007</option>
                                <option>2007</option>
                            </select>
                        </div>

                        <div class="col-3">
                            <label for="monthselect">Месяц</label>
                            <select class="form-select" id="monthselect">
                                <option value>Выбрать...</option>
                                <option>Январь</option>
                                <option>Февраль</option>
                                <option>Март</option>
                                <option>Апрель</option>
                                <option>Май</option>
                                <option>Июнь</option>
                                <option>Июль</option>
                                <option>Август</option>
                                <option>Сентябрь</option>
                                <option>Октябрь</option>
                                <option>Ноябрь</option>
                                <option>Декабрь</option>
                            </select>
                        </div>

                        <div class="col-3">
                            <label for="currentdayselect">День</label>
                            <input id="currentdayselect" class="form-control" type="date" />
                        </div>

                        <div id="closesorting2" class="d-flex col-1 align-items-center mt-4">
                            <a href="#">
                                <img src="Resources/closeicon.png" alt="" height="25" width="25">
                            </a>
                        </div>
                    </div>

                    
                </div>
                
                <div  class="d-flex col-1 align-items-center mb-2"  >
                    <a id="closesorting1" href="#" hidden>
                        <img src="Resources/closeicon.png" alt="" height="25" width="25">
                    </a>
                </div>

            </div>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead style="background-color: lightcoral;">
                        <tr id="sorttr">
                            <th id="#">#</th>
                            <th id="Date">Дата события</th>
                            <th id="Number">Номер АСБ</th>
                            <th id="Device">Устройство</th>
                            <th id="Serios">Серьезность</th>
                            <th id="Delete"></th>
                        </tr>
                    </thead>
                    <tbody id="body">
                    </tbody>
                </table>
            </div>
            <div class="modal fade" id="Modal" tabindex="-1" aria-labelledby="ModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h6 id="idh" hidden></h6>
                            <h5 class="modal-title" id="ModalLabel"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-6">
                                    <textarea class="form-control" rows="3" id="discribe"></textarea>
                                </div>
                                <div class="col-6">
                                    <textarea class="form-control" rows="3" id="fix"></textarea>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" id="savechanges" class="btn btn-softyellow">Сохранить изменения</button>
                            <button type="button" id="closechanges" class="btn btn-softyellow" data-bs-dismiss="modal">Закрыть</button>

                        </div>

                    </div>

                </div>

            </div>
        </div>

    </main>

    <main id="Faq" name="Faq" class="disactivetab">

    </main>
    <script src="bootstrap/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
    <script>

       
        const datesort = document.getElementById("Date");
        const numbersort = document.getElementById("Number");
        const devicesort = document.getElementById("Device");
        const seriossort = document.getElementById("Serios");

        const idh = document.getElementById("idh");
        const Label = document.getElementById("ModalLabel");
        const discribe = document.getElementById("discribe");
        const fix = document.getElementById("fix");

        var tempevent;

        const closebut = document.getElementById("closechanges");

        const tablinks = document.getElementsByClassName("nav-link px-2");

        const editbut = document.getElementById("savechanges");
        editbut.addEventListener("click", function (e) {
            tempevent.discribeevent = discribe.value;
            tempevent.fixevent = fix.value;
            tempevent.id = idh.textContent;
            EditEvent(tempevent.id, tempevent.dateofevent, tempevent.nameofasb, tempevent.nameofdevice, tempevent.isserios, tempevent.discribeevent, tempevent.fixevent);
            closebut.click();
        });


        numbersort.addEventListener("click", Sorting);
        devicesort.addEventListener("click", Sorting);
        seriossort.addEventListener("click", Sorting);
        datesort.addEventListener("click", Sorting);


        document.forms["eventForm"].addEventListener("submit", e => {
            e.preventDefault();
            const form = document.forms["eventForm"];
            const dateofevent = form.elements["dateofevent"].value;
            const nameofasb = form.elements["nameofasb"].value;
            const nameofdevice = form.elements["nameofdevice"].value;
            const isserios = form.elements["isserios"].value;
            const discribeevent = form.elements["discribeevent"].value;
            const fixevent = form.elements["fixevent"].value;
            CreateEvent(dateofevent, nameofasb, nameofdevice, isserios, discribeevent, fixevent);
            form.reset();
        });

        for (var i = 0; i < tablinks.length; i++) {
            tablinks[i].onclick = change;
        }

        function Sorting(event) {

            const sort = event.currentTarget;
            const sorting = document.getElementById("Sorting");
            sorting.innerHTML = "";

            const val = document.createElement("option");
            val.textContent = sort.textContent;
            sorting.appendChild(val);

            const sortingdiv = document.getElementById("sortingdiv");
            sortingdiv.hidden = false;

            const closesorting1 = document.getElementById("closesorting1");
            closesorting1.hidden = false;
            closesorting1.addEventListener("click", function () {
                sortingdiv.hidden = true;
                closesorting1.hidden = true;
                const tempbody = document.querySelector("tbody");
                var trs = tempbody.children;
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                }
            })

            const datediv = document.getElementById("datediv");
            datediv.hidden = true;

            if (sort.textContent == "Дата события") {
               sortingdiv.hidden = true;
                datediv.hidden = false;
                closesorting1.hidden = true;

                const closesorting2 = document.getElementById("closesorting2");
                closesorting2.hidden = false;
                closesorting2.addEventListener("click", function () {
                    datediv.hidden = true;
                    closesorting2.hidden = true;
                    const tempbody = document.querySelector("tbody");
                    var trs = tempbody.children;
                    for (var i = 0; i < trs.length; i++) {
                        trs[i].hidden = false;
                    }
                })
                AddSortingDate();
            }
            if (sort.textContent == "Номер АСБ") {

                AddSortingASB(sorting);

            }
            if (sort.textContent == "Устройство") {

                AddSortingDevice(sorting);
            }
            if (sort.textContent == "Серьезность") {

                AddSortingSerios(sorting);
            }
            const tempbody = document.querySelector("tbody");
            var trs = tempbody.children;
            for (var i = 0; i < trs.length; i++) {
                trs[i].hidden = false;
            }

        }

        function AddSortingDate() {
            const yearselect = document.getElementById("yearselect");
            const monthselect = document.getElementById("monthselect");
            const currentdayselect = document.getElementById("currentdayselect");
            yearselect.addEventListener("change", SortingDate);
            monthselect.addEventListener("change", SortingDate);
            currentdayselect.addEventListener("change", SortingDate);
           

        }

        function AddSortingDate() {
            const yearselect = document.getElementById("yearselect");
            const monthselect = document.getElementById("monthselect");
            const currentdayselect = document.getElementById("currentdayselect");
            yearselect.addEventListener("change", SortingDate);
            monthselect.addEventListener("change", SortingDate);
            currentdayselect.addEventListener("change", SortingDate);

        }

        function AddSortingASB(sorting) {
            sorting.removeEventListener("change", SortingDevice);
            sorting.removeEventListener("change", SortingSerios);
            sorting.addEventListener("change", SortingASB);

            const firstoption = document.createElement("option");
            const thirddoption = document.createElement("option");
            const fourthoption = document.createElement("option");
            const fivesoption = document.createElement("option");
            const sixsoption = document.createElement("option");
            const sevensndoption = document.createElement("option");
            const eigthsoption = document.createElement("option");

            firstoption.textContent = "1";
            thirddoption.textContent = "3";
            fourthoption.textContent = "4";
            fivesoption.textContent = "5";
            sixsoption.textContent = "6";
            sevensndoption.textContent = "7";
            eigthsoption.textContent = "8";

            sorting.appendChild(firstoption);
            sorting.appendChild(thirddoption);
            sorting.appendChild(fourthoption);
            sorting.appendChild(fivesoption);
            sorting.appendChild(sixsoption);
            sorting.appendChild(sevensndoption);
            sorting.appendChild(eigthsoption);

        }

        function AddSortingDevice(sorting) {
            sorting.removeEventListener("change", SortingASB);
            sorting.removeEventListener("change", SortingSerios);
            sorting.addEventListener("change", SortingDevice);

            const ssloption = document.createElement("option");
            const soundcraftoption = document.createElement("option");
            const karreraoption = document.createElement("option");
            const micoption = document.createElement("option");
            const daletoption = document.createElement("option");
            const platinumoption = document.createElement("option");
            const lightoption = document.createElement("option");
            const decoroption = document.createElement("option");
            const camsoption = document.createElement("option");
            const graphicsoption = document.createElement("option");
            const computeroption = document.createElement("option");
            const otheroption = document.createElement("option");

            ssloption.textContent = "SSL";
            soundcraftoption.textContent = "Sound Craft";
            karreraoption.textContent = "Karrera";
            micoption.textContent = "Микрофон, мониторинг, приемопередатчик";
            daletoption.textContent = "Dalet";
            platinumoption.textContent = "Матрица Platinum";
            lightoption.textContent = "Свет и оборудование";
            decoroption.textContent = "Декорации";
            camsoption.textContent = "Камеры и камерные каналы";
            graphicsoption.textContent = "Графические станции";
            computeroption.textContent = "Компьютеры";
            otheroption.textContent = "Другое";

            sorting.appendChild(ssloption);
            sorting.appendChild(soundcraftoption);
            sorting.appendChild(karreraoption);
            sorting.appendChild(micoption);
            sorting.appendChild(daletoption);
            sorting.appendChild(platinumoption);
            sorting.appendChild(lightoption);
            sorting.appendChild(decoroption);
            sorting.appendChild(camsoption);
            sorting.appendChild(graphicsoption);
            sorting.appendChild(computeroption);
            sorting.appendChild(otheroption);

        }

        function AddSortingSerios(sorting) {
            sorting.removeEventListener("change", SortingDevice);
            sorting.removeEventListener("change", SortingASB);
            sorting.addEventListener("change", SortingSerios)

            const Seriosoption = document.createElement("option");
            const Notseriosoption = document.createElement("option");

            Seriosoption.textContent = "Серьезное";
            Notseriosoption.textContent = "Несерьезное";

            sorting.appendChild(Seriosoption);
            sorting.appendChild(Notseriosoption);
        }

        function SortingASB(e) {
            const tempitem = e.currentTarget;
            const tempbody = document.querySelector("tbody");
            var trs = tempbody.children;
            if (tempitem.selectedIndex != 0) {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                    var temptds = trs[i].querySelector("td[name=nameofasb]");
                    if (temptds.textContent != tempitem.options[tempitem.selectedIndex].textContent)
                        trs[i].hidden = true;
                }
            }
            else {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                }
            }
        }

        function SortingDevice(e) {
            const tempitem = e.currentTarget;
            const tempbody = document.querySelector("tbody");
            var trs = tempbody.children;
            if (tempitem.selectedIndex != 0) {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                    var temptds = trs[i].querySelector("td[name=nameofdevice]");
                    if (temptds.textContent != tempitem.options[tempitem.selectedIndex].textContent)
                        trs[i].hidden = true;
                }
            }
            else {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                }
            }
        }

        function SortingSerios(e) {
            const tempitem = e.currentTarget;
            const tempbody = document.querySelector("tbody");
            var trs = tempbody.children;
            if (tempitem.selectedIndex != 0) {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                    var temptds = trs[i].querySelector("td[name=isserios]");
                    if (temptds.textContent != `${tempitem.options[tempitem.selectedIndex].textContent} происшествие`)
                        trs[i].hidden = true;
                }
            }
            else {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                }
            }
        }

        function SortingDate(e) {
            const currentselect = e.currentTarget;
            const tempbody = document.querySelector("tbody");
            var trs = tempbody.children;
            if (currentselect.id == "currentdayselect") {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                    var temptds = trs[i].querySelector("td[name=dateofevent]");
                    if (temptds.textContent != currentselect.value) {
                        trs[i].hidden = true;
                    }
                }
            }
            if (currentselect.selectedIndex != 0) {
                var tempoption = currentselect.options[currentselect.selectedIndex];
                if (currentselect.id == "yearselect") {
                    for (var i = 0; i < trs.length; i++) {
                        trs[i].hidden = false;
                        var temptds = trs[i].querySelector("td[name=dateofevent]");

                        if (!temptds.textContent.includes(tempoption.textContent)) {
                                trs[i].hidden = true;
                        }

                    }
                }
                if (currentselect.id == "monthselect") {
                    var tempmonth;
                    if (tempoption.textContent == "Январь") {
                        tempmonth = "01";
                    }
                    if (tempoption.textContent == "Февраль") {
                        tempmonth = "02";
                    }
                    if (tempoption.textContent == "Март") {
                        tempmonth = "03";
                    }
                    if (tempoption.textContent == "Апрель") {
                        tempmonth = "04";
                    }
                    if (tempoption.textContent == "Май") {
                        tempmonth = "05";
                    }
                    if (tempoption.textContent == "Июнь") {
                        tempmonth = "06";
                    }
                    if (tempoption.textContent == "Июль") {
                        tempmonth = "07";
                    }
                    if (tempoption.textContent == "Август") {
                        tempmonth = "08";
                    }
                    if (tempoption.textContent == "Сентябрь") {
                        tempmonth = "09";
                    }
                    if (tempoption.textContent == "Октябрь") {
                        tempmonth = "10";
                    }
                    if (tempoption.textContent == "Ноябрь") {
                        tempmonth = "11";
                    }
                    if (tempoption.textContent == "Декабрь") {
                        tempmonth = "12";
                    }
                    
                    for (var i = 0; i < trs.length; i++) {
                        trs[i].hidden = false;
                        var temptds = trs[i].querySelector("td[name=dateofevent]");

                        if (!temptds.textContent.slice(4,7).includes(tempmonth)) {
                            trs[i].hidden = true;
                        }

                    }
                }
               
            }
            
            else {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                }
            }

        }

        function change(event) {
            const maintabs = document.getElementsByTagName("main");

            for (var i = 0; i < maintabs.length; i++) {
                maintabs[i].className = "disactivetab";
            }

            document.getElementById(event.currentTarget.name).className = "";
            if (event.currentTarget.name === Histories) {
                row();
            }

        }

        function row(event,num) {

            const tr = document.createElement("tr");

            tr.id = event.id;
            tr.setAttribute("data-rowid", event.id);

            const idTd = document.createElement("td");
            idTd.setAttribute("name", "id");
            idTd.setAttribute("data-bs-toggle", "modal");
            idTd.setAttribute("data-bs-target", "#Modal");
            idTd.append(num);
            tr.append(idTd);

            const dateofeventTd = document.createElement("td");
            dateofeventTd.setAttribute("name", "dateofevent");
            dateofeventTd.setAttribute("data-bs-toggle", "modal");
            dateofeventTd.setAttribute("data-bs-target", "#Modal");
            let datestring = event.dateofevent;
            let correctdate = "";
            for (let i = 0; i < datestring.length; i++) {
                if (datestring[i] === ".") {
                    const repl = datestring[i].replace(".", "-");
                    correctdate = correctdate + repl;
                }
                else {
                    correctdate = correctdate + datestring[i];
                }
            }
            dateofeventTd.append(correctdate);
            tr.append(dateofeventTd);

            const nameofasbTd = document.createElement("td");
            nameofasbTd.setAttribute("name", "nameofasb");
            nameofasbTd.setAttribute("data-bs-toggle", "modal");
            nameofasbTd.setAttribute("data-bs-target", "#Modal");
            nameofasbTd.append(event.nameofasb);
            tr.append(nameofasbTd);

            const nameofdeviceTd = document.createElement("td");
            nameofdeviceTd.setAttribute("name", "nameofdevice");
            nameofdeviceTd.setAttribute("data-bs-toggle", "modal");
            nameofdeviceTd.setAttribute("data-bs-target", "#Modal");
            nameofdeviceTd.append(event.nameofdevice);
            tr.append(nameofdeviceTd);

            const isseriosTd = document.createElement("td");
            isseriosTd.setAttribute("name", "isserios");
            isseriosTd.setAttribute("data-bs-toggle", "modal");
            isseriosTd.setAttribute("data-bs-target", "#Modal");
            isseriosTd.append(event.isserios);
            tr.append(isseriosTd);

            const delbutTd = document.createElement("td");
            delbutTd.setAttribute("name", "delbutTd");
            const delbut = document.createElement("a");
            delbut.href = "#";
            delbut.className = "d-flex align-items-center mb-2 mb-lg-0";
            const delbutimg = document.createElement("img");
            delbutimg.src = "Resources/recyclebin.png";
            delbutimg.alt = "";
            delbutimg.height = "35";
            delbutimg.width = "35";

            delbut.append(delbutimg);
            delbut.addEventListener("click", function (e) {
                DeleteEvent(event.id);
            });


            delbutTd.append(delbut);

            tr.appendChild(delbutTd);

            tr.addEventListener("click", trclick);



            return tr;
        }

        function trclick(event) {
            const curtr = event.currentTarget;
            GetEvent(curtr.id);
        }

        async function EditEvent(eventId, eventDateofevent, eventNameofasb, eventNameofdevice, eventIsserios, eventDiscribeevent, eventFixevent) {
            const response = await fetch("api/events", {
                method: "PUT",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
                body: JSON.stringify({
                    id: parseInt(eventId, 10),
                    dateofevent: eventDateofevent,
                    nameofasb: eventNameofasb,
                    nameofdevice: eventNameofdevice,
                    isserios: eventIsserios,
                    discribeevent: eventDiscribeevent,
                    fixevent: eventFixevent
                })
            });
            if (response.ok === true) {
                const event = await response.json();
                const temptr = document.getElementById(event.id);
                const tdupdate = temptr.querySelector("td");
                const num = parseInt(tdupdate.textContent);
                temptr.replaceWith(row(event, num));
                alert("Происшествие обновлено");

            }

        }

        async function CreateEvent(eventDateofevent, eventNameofasb, eventNameofdevice, eventIsserios, eventDiscribeevent, eventFixevent) {
            const response = await fetch("api/events", {
                method: "POST",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
                body: JSON.stringify({
                    dateofevent: eventDateofevent,
                    nameofasb: parseInt(eventNameofasb, 10),
                    nameofdevice: eventNameofdevice,
                    isserios: eventIsserios,
                    discribeevent: eventDiscribeevent,
                    fixevent: eventFixevent
                })
            });
            if (response.ok === true) {
                const event = await response.json();
                const tds = document.getElementsByName("id");
                const num = tds.length + 1;
                document.querySelector("tbody").append(row(event,num));
                alert("Происшествие создано");

            }
        }

        async function GetEvent(id) {
            const response = await fetch("/api/events/" + id, {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const event = await response.json();
                tempevent = event;
                idh.textContent = event.id;
                Label.textContent = event.nameofdevice;
                discribe.value = event.discribeevent;
                fix.value = event.fixevent;
            }
        }

        async function GetEvents() {

            const response = await fetch("/api/events", {
                method: "GET",
                headers: { "Accept": "application/json" }
            });

            if (response.ok === true) {

                const events = await response.json();
                let rows = document.querySelector("tbody");
                let i = 0;
                events.forEach(event => {
                    const num = ++i;
                    rows.append(row(event,num));
                });
            }
        }

        async function DeleteEvent(id) {
            const response = await fetch("/api/events/" + id, {
                method: "DELETE",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const event = await response.json();
                document.querySelector("tr[data-rowid='" + event.id + "']").remove();
                let tds = document.getElementsByName("id");
                let i = 0;
                tds.forEach(td => {
                    td.textContent = `${++i}`;
                });

                alert("Происшествие удалено");
            }
        }

        GetEvents();


    </script>

</body>
</html>