<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Происшествия</title>
    <link rel="stylesheet" type="text/css" href="bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
    <header class="p-3 darkredclass">
        <div class="container">

            <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-start">
                <img class="img-fluid" src="/Resources/warning_sign.png" width="48" height="48" />

                <ul id="nav" class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0 five-header-ul">
                    <li><a href="#" name="Create" class="nav-link creambrule-link px-1" id="CreateClick">Создать</a></li>
                    <li><a href="#" name="Histories" class="nav-link creambrule-link px-1" id="HistoryClick">История</a></li>
                    <li><a href="#" name="Faq" class="nav-link creambrule-link px-1" id="FaqClick">Бестиарий</a></li>
                </ul>

                <div class="col-lg-auto mb-lg-0 mb-3 mb-md-0 me-lg-3 col-12 five-header-search">
                    <form>
                        <input type="search" class="form-control form-control-dark" placeholder="Искать..." aria-label="Search">
                    </form>
                </div>

                <div class="text-end five-header-btn">
                    <button type="button" class="btn headerbtn me-2">Войти</button>

                    <button type="button" class="btn headerbtn">Регистрация</button>
                </div>
            </div>

        </div>
    </header>
    <main id="Create" class="activetab" name="Create">

        <div class="container-fluid">
            <form name="eventForm" class="was was-validated" id="cardevent">
                <div class="container">
                    <h1 class="h1 darkredtext" id="FirstPage">Карточка происшествия</h1>
                    <div class="row">
                        <div class="col-md-6 col-lg-4 col-sm-6 col-12 mb-3">
                            <label for="nameofdevice">Устройство</label>
                            <select class="form-select d-block w-100 d-done" name="nameofdevice" required>
                                <option value>Выбрать...</option>
                                <option>SSL</option>
                                <option>Karrera</option>
                                <option>SoundCraft</option>
                                <option>Dalet</option>
                                <option>Микрофон, мониторинг, приемопередатчик</option>
                                <option>Platinum</option>
                                <option>Свет и оборудование</option>
                                <option>Декорации</option>
                                <option>Камеры и камерные каналы</option>
                                <option>Графические станции</option>
                                <option>Компьютер</option>
                                <option>Другое</option>
                            </select>
                            <div class="invalid-feedback">Необходимо указать устройство</div>
                        </div>
                        <div class="col-auto mb-3">
                            <label for="nameofasb">Номер АСБ</label>
                            <select class="form-select d-block w-100 d-done" name="nameofasb" required>
                                <option value>Выбрать...</option>
                                <option>1</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                                <option>6</option>
                                <option>7</option>
                                <option>8</option>
                            </select>
                            <div class="invalid-feedback">Необхоимо указать номер АСБ</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 col-lg-4 col-sm-6 col-12 mb-3">
                            <div class="form-group">
                                <label for="eventdiscribe">Описание проблемы</label>
                                <textarea class="form-control" name="discribeevent" rows="3" required></textarea>
                            </div>
                            <div class="invalid-feedback">Заполните описание</div>

                        </div>
                        <div class="col-auto mb-3">
                            <div class="form-group">
                                <label for="fixdiscribe">Как исправили(если исправили)</label>
                                <textarea class="form-control" name="fixevent" rows="3"></textarea>
                            </div>

                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 col-lg-4 col-sm-6 col-12 mb-3">
                            <label for="dateofevent">Дата происшествия</label>
                            <div class="w-100"></div>
                            <input name="dateofevent" class="form-control" type="date" required />
                            <div class="invalid-feedback">Укажите дату происшествия</div>
                        </div>
                        <div class="col-auto mb-3">
                            <label for="isserios">Серьезность</label>
                            <select name="isserios" class="form-select d-block w-100 d-done" required>
                                <option value>Выбрать...</option>
                                <option>Серьезное происшествие</option>
                                <option>Несерьезное происшествие</option>
                            </select>
                            <div class="invalid-feedback">Укажите серьезность</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-7 col-lg-7 col-sm-12 col-12">
                            <div class="input-group mb-3">
                                <label for="inputGroupFile">Фотография поломки</label>
                                <div class="w-100"></div>
                                <input type="file" class="form-control" id="inputGroupFile" aria-describedby="inputGroupFileAddon" aria-label="Загрузить">
                                <button class="btn btn-outline-softbrown" type="button" id="inputGroupFileAddon">Загрузить</button>
                            </div>
                        </div>

                    </div>

                    <div class="row">
                        <div class="col-md-3 col-lg-3 col-sm-6 col-6 mt-sm-3">
                            <button id="submit" type="submit" class="btn darkred-btn">Создать</button>
                        </div>
                        <div class="col-md-4 col-lg-4 col-sm-6 col-6 mt-sm-3">
                            <button id="reset" type="reset" class="btn darkred-btn">Сброс</button>
                        </div>

                    </div>


                </div>
            </form>

        </div>
    </main>
    <main id="Histories" name="Histories" class="disactivetab">

        <div class="container justify-content-center">
            <h1 id="SecondPage" class="darkredtext text-center">История происшествий</h1>
        </div>

        <div class="container-fluid">

            <div class="row">
                <div class="col-lg-3 col-md-4 col-sm-10 col-10 mb-2" hidden id="sortingdiv">
                    <select id="Sorting" class="form-select">
                    </select>

                </div>
                <div class="col-12 mb-2" hidden id="datediv">
                    <div class="row">

                        <div class="col-sm-3 col-6">
                            <label for="yearselect">Год</label>
                            <select class="form-select" id="yearselect">
                                <option value>Выбрать...</option>
                                <option>2022</option>
                                <option>2021</option>
                                <option>2020</option>
                                <option>2019</option>
                                <option>2018</option>
                                <option>2017</option>
                                <option>2016</option>
                                <option>2015</option>
                                <option>2014</option>
                                <option>2014</option>
                                <option>2013</option>
                                <option>2012</option>
                                <option>2011</option>
                                <option>2010</option>
                                <option>2009</option>
                                <option>2008</option>
                                <option>2007</option>
                                <option>2007</option>
                                <option>2007</option>
                                <option>2007</option>
                            </select>
                        </div>

                        <div class="col-6 col-sm-3">
                            <label for="monthselect">Месяц</label>
                            <select class="form-select" id="monthselect">
                                <option value>Выбрать...</option>
                                <option>Январь</option>
                                <option>Февраль</option>
                                <option>Март</option>
                                <option>Апрель</option>
                                <option>Май</option>
                                <option>Июнь</option>
                                <option>Июль</option>
                                <option>Август</option>
                                <option>Сентябрь</option>
                                <option>Октябрь</option>
                                <option>Ноябрь</option>
                                <option>Декабрь</option>
                            </select>
                        </div>

                        <div class="col-6 col-sm-3">
                            <label for="currentdayselect">День</label>
                            <input id="currentdayselect" class="form-control" type="date" />
                        </div>

                        <div id="closesorting2" class="d-flex col-2 align-items-center mt-4">
                            <a href="#">
                                <img src="Resources/closeicon.png" alt="" height="25" width="25">
                            </a>
                        </div>
                    </div>


                </div>

                <div class="d-flex col-2 align-items-center mb-2">
                    <a id="closesorting1" href="#" hidden>
                        <img src="Resources/closeicon.png" alt="" height="25" width="25">
                    </a>
                </div>

            </div>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="softpinkclass creambrule-text" style="vertical-align:middle">
                        <tr id="sorttr">
                            <th id="#">#</th>
                            <th id="Date">Дата события</th>
                            <th id="Number">Номер АСБ</th>
                            <th id="Device">Устройство</th>
                            <th id="Serios">Серьезность</th>
                            <th id="Delete"></th>
                        </tr>
                    </thead>
                    <tbody id="body">
                    </tbody>
                </table>
            </div>
            <div class="modal fade" id="Modal" tabindex="-1" aria-labelledby="ModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h6 id="idh" hidden></h6>
                            <h5 class="modal-title" id="ModalLabel"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-xs-6">
                                    <textarea class="form-control" rows="3" id="discribe"></textarea>
                                </div>
                                <div class="col-xs-6">
                                    <textarea class="form-control" rows="3" id="fix"></textarea>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" id="savechanges" class="btn btn-softyellow">Сохранить изменения</button>
                            <button type="button" id="closechanges" class="btn btn-softyellow" data-bs-dismiss="modal">Закрыть</button>

                        </div>

                    </div>

                </div>

            </div>
        </div>

    </main>
    <main id="Faq" name="Faq" class="disactivetab">
        <div class="container" style="margin-left:0px;">
            <div class="row">

                <div class="d-flex flex-column flex-shrink-0 p-3 softpinkclass col-12 col-sm-4 col-md-4 col-lg-3 faq-div">
                    <a id="CollapseBtn" href="#CollapseUl" class="faq-btn-collapse" data-bs-toggle="collapse" role="button" aria-controls="CollapseUl" aria-expanded="false">
                        <svg viewBox="0 0 35 4" xlms="http://www.w3.org/2000/svg">
                            <line x1="5" x2="30" y1="1" y2="1" />
                            <line x1="5" x2="30" y1="2" y2="2" />
                            <line x1="5" x2="30" y1="3" y2="3" />
                        </svg>
                    </a>

                    <ul id="CollapseUl" class="nav collapse faq-ul-collapse mb-auto ">
                        <li class="navitem">

                            <a id="CollapseCam" href="#CamsLinks" class="faqlink softredtext" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="CamsLinks">
                                <img src="Resources/camera.png" class="img-fluid" height="48" width="48" />
                                Камеры, CCU и OCP
                            </a>

                            <ul class="nav collapse faq-ul-minilink-collapse" id="CamsLinks">
                            </ul>

                        </li>
                        <li class="navitem">

                            <a id="CollapseVideoMixer" href="#VideoMixerLinks" class="faqlink softredtext" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="VideoMixerLinks">
                                <img src="Resources/GVvideomixer.png" class="img-fluid" height="48" width="48" />
                                Видеопульт
                            </a>

                            <ul class="nav collapse faq-ul-minilink-collapse" id="VideoMixerLinks">
                            </ul>

                        </li>
                        <li class="navitem">

                            <a id="CollapseSoundMixer" href="#SoundMixerLinks" class="faqlink softredtext" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="SoundMixerLinks">
                                <img src="Resources/soundmixer.png" class="img-fluid" height="48" width="48" />
                                Звуковые пульты
                            </a>

                            <ul class="nav collapse faq-ul-minilink-collapse" id="SoundMixerLinks">
                            </ul>

                        </li>
                        <li class="navitem">

                            <a id="CollapseMatrix" href="#MatrixLinks" class="faqlink softredtext" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="MatrixLinks">
                                <img src="Resources/matrix.png" class="img-fluid" height="48" width="48" />
                                Матрица
                            </a>

                            <ul class="nav collapse faq-ul-minilink-collapse" id="MatrixLinks">
                            </ul>

                        </li>
                        <li class="navitem">

                            <a id="CollapseSoundDevice" href="#SoundDeviceLinks" class="faqlink softredtext" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="MatrixLinks">
                                <img src="Resources/microphone.png" class="img-fluid" height="48" width="48" />
                                Звуковое оборудование
                            </a>

                            <ul class="nav collapse faq-ul-minilink-collapse" id="SoundDeviceLinks">
                            </ul>

                        </li>
                        <li class="navitem">

                            <a id="CollapseComputers" href="#ComputerDeviceLinks" class="faqlink softredtext" data-bs-toggle="collapse" role="button" aria-controls="ComputerDeviceLinks" aria-expanded="false">
                                <img src="Resources/computer.png" class="img-fluid" height="48" width="48" />
                                Компьютеры, Графические станции, Dalet
                            </a>

                            <ul class="nav collapse faq-ul-minilink-collapse" id="ComputerDeviceLinks">
                            </ul>

                        </li>
                        <li class="navitem">

                            <a id="CollapseLightDevice" href="#LightDeviceLinks" class="faqlink softredtext" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="LightDeviceLinks">
                                <img src="Resources/spotlight.png" class="img-fluid" height="48" width="48" />
                                Световое оборудование
                            </a>

                            <ul class="nav collapse faq-ul-minilink-collapse" id="LightDeviceLinks">
                            </ul>

                        </li>
                        <li class="navitem">

                            <a id="CollapseStudio" href="#StudioLinks" class="faqlink softredtext" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="StudioLinks">
                                <img src="Resources/studio.png" class="img-fluid" height="48" width="48" />
                                Студия
                            </a>

                            <ul class="nav collapse faq-ul-minilink-collapse" id="StudioLinks">
                            </ul>

                        </li>
                        <li class="navitem">

                            <a id="AddInfo" href="#AddInfo" class="faqlink softredtext">
                                <img src="Resources/add.png" class="img-fluid" height="48" width="48" />
                                Добавить информацию
                            </a>

                        </li>
                        <li class="navitem">

                            <a id="UpdateInfo" href="#UpdateInfo" class="faqlink softredtext">
                                <img src="Resources/update.png" class="img-fluid" height="48" width="48" />
                                Редактировать информацию
                            </a>

                        </li>
                    </ul>
                </div>
                <div class="col-12 col-sm-8 col-md-8 col-lg-9">

                    <h1 id="ThirdPage" class="darkredtext text-center">Бестиарий</h1>
                    <div id="ForTextDiv" class="container">
                        <p id="PageText"></p>
                        <form id="InfoForm" class="hide-form">
                            <div class="row">
                                <div class="col-lg-4 offset-4 mb-3">
                                    <input class="info-input" placeholder="Введите заголовок..." />
                                </div>
                                <div class="col-lg-12">
                                    <textarea class="form-control info-input" rows="10"></textarea>
                                </div>

                            </div>

                            <div class="row mt-3">
                                <button id="CreatePageBut" class="btn darkred-btn col-lg-3 offset-2">Добавить</button>
                                <button id="ResetPageBut" type="reset" class="btn darkred-btn col-lg-3 offset-1">Сброс значений</button>

                            </div>
                        </form>

                    </div>
                </div>

            </div>

        </div>
    </main>

    <script>
        const tablinks = document.getElementsByClassName("nav-link creambrule-link px-1");

        function Сhange(event) {
            const maintabs = document.querySelectorAll("main");
            for (var num = 0; num < maintabs.length; num++) {
                maintabs[num].className = "disactivetab";
            }

            document.getElementById(event.currentTarget.name).className = "activetab";
            if (event.currentTarget.id === "HistoryClick") {
                GetEvents();
            }

            if (event.currentTarget.id === "FaqClick") {
                GetPages();
            }

        }
        for (var tabnum = 0; tabnum < tablinks.length; tabnum++) {
            tablinks[tabnum].onclick = Сhange;
        }

        const datesort = document.getElementById("Date");
        const numbersort = document.getElementById("Number");
        const devicesort = document.getElementById("Device");
        const seriossort = document.getElementById("Serios");

        const idh = document.getElementById("idh");
        const Label = document.getElementById("ModalLabel");
        const discribe = document.getElementById("discribe");
        const fix = document.getElementById("fix");

        var tempevent;

        const closebut = document.getElementById("closechanges");

        const editbut = document.getElementById("savechanges");
        editbut.addEventListener("click", function (e) {
            tempevent.discribeevent = discribe.value;
            tempevent.fixevent = fix.value;
            tempevent.eventid = idh.textContent;
            EditEvent(tempevent.eventId, tempevent.dateofevent, tempevent.nameofasb, tempevent.nameofdevice, tempevent.isserios, tempevent.discribeevent, tempevent.fixevent);
            closebut.click();
        });

        const navitems = document.getElementsByClassName("navitem");

        function Activelink(e) {
            for (var k = 0; k < navitems.length; k++) {
                navitems[k].className = "navitem";
                navitems[k].firstElementChild.className = "faqlink softredtext";
            }
            const InfoForm = document.getElementById("InfoForm");
            InfoForm.className = "hide-form";
            const curlink = e.currentTarget;
            curlink.className = "navitem activenavitem";
            curlink.firstElementChild.className = "faqlink darkredtext";
            const ForTextDiv = document.getElementById("ForTextDiv");
            const thirdpage = document.getElementById("ThirdPage");
            thirdpage.textContent = curlink.firstElementChild.textContent;
            if (curlink.firstElementChild.id == "AddInfo") {
                InfoForm.className = "";

            }
        }

        for (var n = 0; n < navitems.length; n++) {
            navitems[n].onclick = Activelink;
        }

        numbersort.addEventListener("click", Sorting);
        devicesort.addEventListener("click", Sorting);
        seriossort.addEventListener("click", Sorting);
        datesort.addEventListener("click", Sorting);


        document.forms["eventForm"].addEventListener("submit", e => {
            e.preventDefault();
            const form = document.forms["eventForm"];
            const dateofevent = form.elements["dateofevent"].value;
            const nameofasb = form.elements["nameofasb"].value;
            const nameofdevice = form.elements["nameofdevice"].value;
            const isserios = form.elements["isserios"].value;
            const discribeevent = form.elements["discribeevent"].value;
            const fixevent = form.elements["fixevent"].value;
            CreateEvent(dateofevent, nameofasb, nameofdevice, isserios, discribeevent, fixevent);
            form.reset();
        });

        function Sorting(event) {

            const sort = event.currentTarget;
            const sorting = document.getElementById("Sorting");
            sorting.innerHTML = "";

            const val = document.createElement("option");
            val.textContent = sort.textContent;
            sorting.appendChild(val);

            const sortingdiv = document.getElementById("sortingdiv");
            sortingdiv.hidden = false;

            const closesorting1 = document.getElementById("closesorting1");
            closesorting1.hidden = false;
            closesorting1.addEventListener("click", function () {
                sortingdiv.hidden = true;
                closesorting1.hidden = true;
                const tempbody = document.querySelector("tbody");
                var trs = tempbody.children;
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                }
            })

            const datediv = document.getElementById("datediv");
            datediv.hidden = true;

            if (sort.textContent == "Дата события") {
                sortingdiv.hidden = true;
                datediv.hidden = false;
                closesorting1.hidden = true;

                const closesorting2 = document.getElementById("closesorting2");
                closesorting2.hidden = false;
                closesorting2.addEventListener("click", function () {
                    datediv.hidden = true;
                    closesorting2.hidden = true;
                    const tempbody = document.querySelector("tbody");
                    var trs = tempbody.children;
                    for (var i = 0; i < trs.length; i++) {
                        trs[i].hidden = false;
                    }
                })
                AddSortingDate();
            }
            if (sort.textContent == "Номер АСБ") {

                AddSortingASB(sorting);

            }
            if (sort.textContent == "Устройство") {

                AddSortingDevice(sorting);
            }
            if (sort.textContent == "Серьезность") {

                AddSortingSerios(sorting);
            }
            const tempbody = document.querySelector("tbody");
            var trs = tempbody.children;
            for (var i = 0; i < trs.length; i++) {
                trs[i].hidden = false;
            }

        }

        function AddSortingDate() {
            const yearselect = document.getElementById("yearselect");
            const monthselect = document.getElementById("monthselect");
            const currentdayselect = document.getElementById("currentdayselect");
            yearselect.addEventListener("change", SortingDate);
            monthselect.addEventListener("change", SortingDate);
            currentdayselect.addEventListener("change", SortingDate);


        }

        function AddSortingDate() {
            const yearselect = document.getElementById("yearselect");
            const monthselect = document.getElementById("monthselect");
            const currentdayselect = document.getElementById("currentdayselect");
            yearselect.addEventListener("change", SortingDate);
            monthselect.addEventListener("change", SortingDate);
            currentdayselect.addEventListener("change", SortingDate);

        }

        function AddSortingASB(sorting) {
            sorting.removeEventListener("change", SortingDevice);
            sorting.removeEventListener("change", SortingSerios);
            sorting.addEventListener("change", SortingASB);

            const firstoption = document.createElement("option");
            const thirddoption = document.createElement("option");
            const fourthoption = document.createElement("option");
            const fivesoption = document.createElement("option");
            const sixsoption = document.createElement("option");
            const sevensndoption = document.createElement("option");
            const eigthsoption = document.createElement("option");

            firstoption.textContent = "1";
            thirddoption.textContent = "3";
            fourthoption.textContent = "4";
            fivesoption.textContent = "5";
            sixsoption.textContent = "6";
            sevensndoption.textContent = "7";
            eigthsoption.textContent = "8";

            sorting.appendChild(firstoption);
            sorting.appendChild(thirddoption);
            sorting.appendChild(fourthoption);
            sorting.appendChild(fivesoption);
            sorting.appendChild(sixsoption);
            sorting.appendChild(sevensndoption);
            sorting.appendChild(eigthsoption);

        }

        function AddSortingDevice(sorting) {
            sorting.removeEventListener("change", SortingASB);
            sorting.removeEventListener("change", SortingSerios);
            sorting.addEventListener("change", SortingDevice);

            const ssloption = document.createElement("option");
            const soundcraftoption = document.createElement("option");
            const karreraoption = document.createElement("option");
            const micoption = document.createElement("option");
            const daletoption = document.createElement("option");
            const platinumoption = document.createElement("option");
            const lightoption = document.createElement("option");
            const decoroption = document.createElement("option");
            const camsoption = document.createElement("option");
            const graphicsoption = document.createElement("option");
            const computeroption = document.createElement("option");
            const otheroption = document.createElement("option");

            ssloption.textContent = "SSL";
            soundcraftoption.textContent = "Sound Craft";
            karreraoption.textContent = "Karrera";
            micoption.textContent = "Микрофон, мониторинг, приемопередатчик";
            daletoption.textContent = "Dalet";
            platinumoption.textContent = "Матрица Platinum";
            lightoption.textContent = "Свет и оборудование";
            decoroption.textContent = "Декорации";
            camsoption.textContent = "Камеры и камерные каналы";
            graphicsoption.textContent = "Графические станции";
            computeroption.textContent = "Компьютеры";
            otheroption.textContent = "Другое";

            sorting.appendChild(ssloption);
            sorting.appendChild(soundcraftoption);
            sorting.appendChild(karreraoption);
            sorting.appendChild(micoption);
            sorting.appendChild(daletoption);
            sorting.appendChild(platinumoption);
            sorting.appendChild(lightoption);
            sorting.appendChild(decoroption);
            sorting.appendChild(camsoption);
            sorting.appendChild(graphicsoption);
            sorting.appendChild(computeroption);
            sorting.appendChild(otheroption);

        }

        function AddSortingSerios(sorting) {
            sorting.removeEventListener("change", SortingDevice);
            sorting.removeEventListener("change", SortingASB);
            sorting.addEventListener("change", SortingSerios)

            const Seriosoption = document.createElement("option");
            const Notseriosoption = document.createElement("option");

            Seriosoption.textContent = "Серьезное";
            Notseriosoption.textContent = "Несерьезное";

            sorting.appendChild(Seriosoption);
            sorting.appendChild(Notseriosoption);
        }

        function SortingASB(e) {
            const tempitem = e.currentTarget;
            const tempbody = document.querySelector("tbody");
            var trs = tempbody.children;
            if (tempitem.selectedIndex != 0) {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                    var temptds = trs[i].querySelector("td[name=nameofasb]");
                    if (temptds.textContent != tempitem.options[tempitem.selectedIndex].textContent)
                        trs[i].hidden = true;
                }
            }
            else {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                }
            }
        }

        function SortingDevice(e) {
            const tempitem = e.currentTarget;
            const tempbody = document.querySelector("tbody");
            var trs = tempbody.children;
            if (tempitem.selectedIndex != 0) {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                    var temptds = trs[i].querySelector("td[name=nameofdevice]");
                    if (temptds.textContent != tempitem.options[tempitem.selectedIndex].textContent)
                        trs[i].hidden = true;
                }
            }
            else {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                }
            }
        }

        function SortingSerios(e) {
            const tempitem = e.currentTarget;
            const tempbody = document.querySelector("tbody");
            var trs = tempbody.children;
            if (tempitem.selectedIndex != 0) {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                    var temptds = trs[i].querySelector("td[name=isserios]");
                    if (temptds.textContent != `${tempitem.options[tempitem.selectedIndex].textContent} происшествие`)
                        trs[i].hidden = true;
                }
            }
            else {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                }
            }
        }

        function SortingDate(e) {
            const currentselect = e.currentTarget;
            const tempbody = document.querySelector("tbody");
            var trs = tempbody.children;
            if (currentselect.id == "currentdayselect") {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                    var temptds = trs[i].querySelector("td[name=dateofevent]");
                    if (temptds.textContent != currentselect.value) {
                        trs[i].hidden = true;
                    }
                }
            }
            if (currentselect.selectedIndex != 0) {
                var tempoption = currentselect.options[currentselect.selectedIndex];
                if (currentselect.id == "yearselect") {
                    for (var i = 0; i < trs.length; i++) {
                        trs[i].hidden = false;
                        var temptds = trs[i].querySelector("td[name=dateofevent]");

                        if (!temptds.textContent.includes(tempoption.textContent)) {
                            trs[i].hidden = true;
                        }

                    }
                }
                if (currentselect.id == "monthselect") {
                    var tempmonth;
                    if (tempoption.textContent == "Январь") {
                        tempmonth = "01";
                    }
                    if (tempoption.textContent == "Февраль") {
                        tempmonth = "02";
                    }
                    if (tempoption.textContent == "Март") {
                        tempmonth = "03";
                    }
                    if (tempoption.textContent == "Апрель") {
                        tempmonth = "04";
                    }
                    if (tempoption.textContent == "Май") {
                        tempmonth = "05";
                    }
                    if (tempoption.textContent == "Июнь") {
                        tempmonth = "06";
                    }
                    if (tempoption.textContent == "Июль") {
                        tempmonth = "07";
                    }
                    if (tempoption.textContent == "Август") {
                        tempmonth = "08";
                    }
                    if (tempoption.textContent == "Сентябрь") {
                        tempmonth = "09";
                    }
                    if (tempoption.textContent == "Октябрь") {
                        tempmonth = "10";
                    }
                    if (tempoption.textContent == "Ноябрь") {
                        tempmonth = "11";
                    }
                    if (tempoption.textContent == "Декабрь") {
                        tempmonth = "12";
                    }

                    for (var i = 0; i < trs.length; i++) {
                        trs[i].hidden = false;
                        var temptds = trs[i].querySelector("td[name=dateofevent]");

                        if (!temptds.textContent.slice(4, 7).includes(tempmonth)) {
                            trs[i].hidden = true;
                        }

                    }
                }

            }

            else {
                for (var i = 0; i < trs.length; i++) {
                    trs[i].hidden = false;
                }
            }

        }

        function row(event, num) {

            const tr = document.createElement("tr");

            tr.id = event.eventId;
            tr.setAttribute("data-rowid", event.eventId);

            const idTd = document.createElement("td");
            idTd.setAttribute("name", "id");
            idTd.setAttribute("data-bs-toggle", "modal");
            idTd.setAttribute("data-bs-target", "#Modal");
            idTd.append(num);
            tr.append(idTd);

            const dateofeventTd = document.createElement("td");
            dateofeventTd.setAttribute("name", "dateofevent");
            dateofeventTd.setAttribute("data-bs-toggle", "modal");
            dateofeventTd.setAttribute("data-bs-target", "#Modal");
            let datestring = event.dateofevent;
            let correctdate = "";
            for (let i = 0; i < datestring.length; i++) {
                if (datestring[i] === ".") {
                    const repl = datestring[i].replace(".", "-");
                    correctdate = correctdate + repl;
                }
                else {
                    correctdate = correctdate + datestring[i];
                }
            }
            dateofeventTd.append(correctdate);
            tr.append(dateofeventTd);

            const nameofasbTd = document.createElement("td");
            nameofasbTd.setAttribute("name", "nameofasb");
            nameofasbTd.setAttribute("data-bs-toggle", "modal");
            nameofasbTd.setAttribute("data-bs-target", "#Modal");
            nameofasbTd.append(event.nameofasb);
            tr.append(nameofasbTd);

            const nameofdeviceTd = document.createElement("td");
            nameofdeviceTd.setAttribute("name", "nameofdevice");
            nameofdeviceTd.setAttribute("data-bs-toggle", "modal");
            nameofdeviceTd.setAttribute("data-bs-target", "#Modal");
            nameofdeviceTd.append(event.nameofdevice);
            tr.append(nameofdeviceTd);

            const isseriosTd = document.createElement("td");
            isseriosTd.setAttribute("name", "isserios");
            isseriosTd.setAttribute("data-bs-toggle", "modal");
            isseriosTd.setAttribute("data-bs-target", "#Modal");
            isseriosTd.append(event.isserios);
            tr.append(isseriosTd);

            const delbutTd = document.createElement("td");
            delbutTd.setAttribute("name", "delbutTd");
            const delbut = document.createElement("a");
            delbut.href = "#";
            delbut.className = "d-flex align-items-center mb-2 mb-lg-0";
            const delbutimg = document.createElement("img");
            delbutimg.src = "Resources/recyclebin.png";
            delbutimg.alt = "";
            delbutimg.height = "35";
            delbutimg.width = "35";

            delbut.append(delbutimg);
            delbut.addEventListener("click", function (e) {
                DeleteEvent(event.eventId);
            });


            delbutTd.append(delbut);

            tr.appendChild(delbutTd);

            tr.addEventListener("click", trclick);



            return tr;
        }

        function trclick(event) {
            const curtr = event.currentTarget;
            GetEvent(curtr.id);
        }

        async function EditEvent(eventid, eventDateofevent, eventNameofasb, eventNameofdevice, eventIsserios, eventDiscribeevent, eventFixevent) {
            const response = await fetch("/api/events", {
                method: "PUT",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
                body: JSON.stringify({
                    eventId: parseInt(eventid, 10),
                    dateofevent: eventDateofevent,
                    nameofasb: eventNameofasb,
                    nameofdevice: eventNameofdevice,
                    isserios: eventIsserios,
                    discribeevent: eventDiscribeevent,
                    fixevent: eventFixevent
                })
            });
            if (response.ok === true) {
                const event = await response.json();
                const temptr = document.getElementById(event.eventId);
                const tdupdate = temptr.querySelector("td");
                const num = parseInt(tdupdate.textContent);
                temptr.replaceWith(row(event, num));
                alert("Происшествие обновлено");

            }

        }

        async function CreateEvent(eventDateofevent, eventNameofasb, eventNameofdevice, eventIsserios, eventDiscribeevent, eventFixevent) {
            const response = await fetch("/api/events", {
                method: "POST",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
                body: JSON.stringify({
                    dateofevent: eventDateofevent,
                    nameofasb: parseInt(eventNameofasb, 10),
                    nameofdevice: eventNameofdevice,
                    isserios: eventIsserios,
                    discribeevent: eventDiscribeevent,
                    fixevent: eventFixevent
                })
            });
            if (response.ok === true) {
                const event = await response.json();
                const tds = document.getElementsByName("id");
                const num = tds.length + 1;
                document.querySelector("tbody").append(row(event, num));
                alert("Происшествие создано");

            }
        }

        async function GetEvent(id) {
            const response = await fetch("/api/events/" + id, {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const event = await response.json();
                tempevent = event;
                idh.textContent = event.eventId;
                Label.textContent = event.nameofdevice;
                discribe.value = event.discribeevent;
                fix.value = event.fixevent;
            }
        }

        async function GetEvents() {

            const response = await fetch("/api/events", {
                method: "GET",
                headers: { "Accept": "application/json" }
            });

            if (response.ok === true) {

                const events = await response.json();
                let rows = document.querySelector("tbody");
                let i = 0;
                events.forEach(event => {
                    const num = ++i;
                    rows.append(row(event, num));
                });
            }
        }

        async function GetPages() {
            const response = await fetch("/api/pages", {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const pages = await response.json();
                const uls = document.getElementsByClassName("nav collapse faq-ul-minilink-collapse");
                for (let i = 0; i < uls.length; i++) {
                    for (let j = 0; j < pages.length; j++) {
                        if (uls[i].id == "CamsLinks") {
                            if (pages[j].header == "Камеры, CCU и OCP") {
                                AddLinks(pages[j], uls[i]);
                            }
                        }
                        else if (uls[i].id == "VideoMixerLinks") {
                            if (pages[j].header == "Видеопульт") {
                                AddLinks(pages[j], uls[i]);
                            }
                        }
                        else if (uls[i].id == "SoundMixerLinks") {
                            if (pages[j].header == "Звуковые пульты") {
                                AddLinks(pages[j], uls[i]);
                            }
                        }
                        else if (uls[i].id == "MatrixLinks") {
                            if (pages[j].header == "Матрица") {
                                AddLinks(pages[j], uls[i]);
                            }
                        }
                        else if (uls[i].id == "SoundDeviceLinks") {
                            if (pages[j].header == "Звуковое оборудование") {
                                AddLinks(pages[j], uls[i]);
                            }
                        }
                        else if (uls[i].id == "ComputerDeviceLinks") {
                            if (pages[j].header == "Компьютеры, Графические станции, Dalet") {
                                AddLinks(pages[j], uls[i]);
                            }
                        }
                        else if (uls[i].id == "LightDeviceLinks") {
                            if (pages[j].header == "Световое оборудование") {
                                AddLinks(pages[j], uls[i]);
                            }
                        }
                        else if (uls[i].id == "StudioLinks") {
                            if (pages[j].header == "Студия") {
                                AddLinks(pages[j], uls[i]);
                            }
                        }

                    }
                }
            }
        }

        function AddLinks(page, ullink) {
            const links = document.createElement("li");
            const linka = document.createElement("a");
            linka.className = "nav-link faq-minilink";
            linka.textContent = page.subheader;
            linka.addEventListener("click", PageClick);
            links.appendChild(linka);
            ullink.appendChild(links);
        }

        async function GetPage(subheader) {
            const response = await fetch("/api/pages/" + subheader, {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const page = await response.json();
                const headertext = document.getElementById("ThirdPage");
                headertext.textContent = `${page.header}\n\n${page.subheader}`;
                const textarea = document.getElementById("PageText");
                textarea.textContent = page.info;
                
            }
        }

        function PageClick(e) {
            GetPage(e.currentTarget.textContent);
             
        }

        async function DeleteEvent(id) {
            const response = await fetch("/api/events/" + id, {
                method: "DELETE",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const event = await response.json();
                document.querySelector("tr[data-rowid='" + event.eventId + "']").remove();
                let tds = document.getElementsByName("id");
                let i = 0;
                tds.forEach(td => {
                    td.textContent = `${++i}`;
                });

                alert("Происшествие удалено");
            }
        }

        const createpagebut = document.getElementById("CreatePageBut");
        createpagebut.addEventListener("click", CreatePage);
        async function CreatePage(pageheader, pagesubheader, pageinfo) {
            const response = await fetch("/api/pages/", {
                method: "POST",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
                body: JSON.stringify({
                    header: pageheader,
                    subheader: pagesubheader,
                    info: pageinfo
                })

            });
            if (response.ok === true) {
                const page = await response.json();
                const ullink = document.getElementById(page.header);
                const newa = document.createElement(a);
                const newlink = document.createElement(li);
                newa.textContent = page.subheader;
                newa.className = "nav-link faq-minilink";
                newlink.appendChild(newa);
                ullink.appendChild(newlink);
                alert("Статья создана");
            }
        }

    </script>

    <script src="bootstrap/dist/js/bootstrap.bundle.min.js"  crossorigin="anonymous"></script>

</body>
</html>
